<html>
  <head>
    <title>Youtube downloader webui</title>
    <link rel="stylesheet" href="./index.css">
    <link rel="stylesheet" href="./table.css">
  </head>
  <body>
    <template id="sortable-table" href="./table.html"></template>
    <template id="entry-description">
      <table>
        <tr><td>Filename</td><td>{{ entry.video_id }}.{{ entry.audio_ext }}</td></tr>
        <tr><td>Status</td><td>{{ entry.status }}</td></tr>
        <tr><td>Time</td><td>{{ entry.unix_time }}</td></tr>
        <template v-if="entry.audio_path">
          <tr><td>Audio</td><td><a :href="entry.audio_path.replaceAll('\\', '/')">Link</a></td></tr>
        </template>
        <template v-if="entry.infojson_path">
          <tr><td>Metadata</td><td><a :href="entry.infojson_path.replaceAll('\\', '/')">Link</a></td></tr>
        </template>
        <template v-if="entry.stdout_log_path">
          <tr><td>Stdout log</td><td><a :href="entry.stdout_log_path.replaceAll('\\', '/')">Link</a></td></tr>
        </template>
        <template v-if="entry.stderr_log_path">
          <tr><td>Stderr log</td><td><a :href="entry.stderr_log_path.replaceAll('\\', '/')">Link</a></td></tr>
        </template>
        <template v-if="entry.system_log_path">
          <tr><td>System log</td><td><a :href="entry.system_log_path.replaceAll('\\', '/')">Link</a></td></tr>
        </template>
      </table>
    </template>
    <div id="app">
      <h2>Transcode request</h2>
      <div>
        <label>URL</label><input type="text" v-model="transcode_request.url" placeholder="Youtube URL"/>
        <label>Format</label>
        <select v-model="transcode_request.format">
          <option value="mp3">mp3</option>
          <option value="m4a">m4a</option>
          <option value="webm">webm</option>
          <option value="aac">aac</option>
        </select>
        <button @click="request_transcode()">Request</button>
        <button @click="get_transcode_progress()">Get progress</button>
        <br>
        <ul>
          <li v-if="transcode_request.url_error !== null">URL error: {{ transcode_request.url_error }}</li>
          <li>Response: {{ transcode_request.response }}</li>
          <li>Download state: {{ transcode_request.download_state }}</li>
          <li>Transcode state: {{ transcode_request.transcode_state }}</li>
        </ul>
      </div>
      <br>
      <h2>Downloads</h2>
      <button @click="refresh_downloads()">Refresh downloads</button>
      <sortable-table 
        :columns="download_list_columns" :data="download_list" :init-sort-column="'unix_time'"
        :actions="[{ name: 'delete', icon: 'ðŸ—‘'}]"
        @row-select="(index) => download_list_index = index"
        @row-action="(action) => on_download_table_action(action)"
      ></sortable-table>
      <entry-description :entry="download_entry" v-if="download_entry !== undefined"></entry-description>
      <br>
      <h2>Transcodes</h2>
      <button @click="refresh_transcodes()">Refresh transcodes</button>
      <sortable-table
        :columns="transcode_list_columns" :data="transcode_list" :init-sort-column="'unix_time'"
        :actions="[{ name: 'delete', icon: 'ðŸ—‘'}]"
        @row-select="(index) => transcode_list_index = index"
        @row-action="(action) => on_transcode_table_action(action)"
      ></sortable-table>
      <entry-description :entry="transcode_entry" v-if="transcode_entry !== undefined"></entry-description>
    </div>
    <script type="module">
      import { create_app, load_html_fragments } from "./index.js";
      await load_html_fragments();
      create_app().mount("#app");
    </script>
  </body>
</html>
